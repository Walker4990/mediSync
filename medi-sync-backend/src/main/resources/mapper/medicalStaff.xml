<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mediSync.project.medical.mapper.MedicalStaffMapper">

    <!-- 의료진 목록 조회 -->
    <select id="findAllStaff" resultType="adminAccount">
        SELECT
        admin_id       AS adminId,
        emp_id         AS empId,
        name           AS name,
        position       AS position,
        role           AS role,
        dept_id        AS deptId,
        license_no     AS licenseNo,
        phone          AS phone,
        email          AS email,
        status         AS status,
        hired_date     AS hiredDate,
        created_at     AS createdAt
        FROM admin_account
        WHERE position IN ('NURSE','RADIOLOGIST','LAB_TECH','ASSISTANT','DOCTOR')
        ORDER BY created_at DESC
    </select>

    <!-- 의료진 등록 -->
    <insert id="addStaff" parameterType="adminAccount" useGeneratedKeys="true" keyProperty="adminId">
        INSERT INTO admin_account
        (emp_id, password, name, position, role, dept_id, license_no, phone, email, status, hired_date, created_at)
        VALUES
        (#{empId}, #{password}, #{name}, #{position}, #{role}, #{deptId}, #{licenseNo}, #{phone}, #{email}, #{status}, #{hiredDate}, NOW())
    </insert>

    <!-- 의료진 정보 수정 -->
    <update id="updateStaff" parameterType="adminAccount">
        UPDATE admin_account
        SET
        name        = #{name},
        position    = #{position},
        dept_id     = #{deptId},
        phone       = #{phone},
        email       = #{email},
        status      = #{status},
        license_no  = #{licenseNo},
        hired_date  = #{hiredDate},
        updated_at  = NOW()
        WHERE admin_id = #{adminId}
    </update>

    <!-- 의료진 삭제 -->
    <delete id="deleteStaff" parameterType="long">
        DELETE FROM admin_account
        WHERE admin_id = #{adminId}
    </delete>

    <!-- 의료진 검색 (수술, 배정 등) -->
    <select id="searchStaffByKeyword" parameterType="string" resultType="adminAccount">
        SELECT
        admin_id AS adminId,
        name     AS name,
        position AS position,
        dept_id  AS deptId
        FROM admin_account
        WHERE position IN ('NURSE','RADIOLOGIST','LAB_TECH','ASSISTANT','DOCTOR')
        AND (
        name LIKE CONCAT('%', #{keyword}, '%')
        OR position LIKE CONCAT('%', #{keyword}, '%')
        )
        LIMIT 10;
    </select>

</mapper>

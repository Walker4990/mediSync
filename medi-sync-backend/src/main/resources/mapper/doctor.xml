<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mediSync.project.medical.mapper.DoctorMapper">

    <!--  의사 목록 조회 -->
    <select id="doctorSelectAll" resultType="adminAccount">
        SELECT
        a.admin_id       AS adminId,
        a.name           AS name,
        a.phone          AS phone,
        a.email          AS email,
        a.license_no     AS licenseNo,
        a.position       AS position,
        a.license_no     AS licenseNo,
        a.dept_id        AS deptId,
        d.dept_name      AS deptName,
        a.status         AS status,
        a.hired_date     AS hiredDate,
        a.created_at     AS createdAt
        FROM admin_account a
        JOIN department d ON a.dept_id = d.dept_id
        ORDER BY a.admin_id DESC
    </select>

    <!-- ️ 의사 단건 조회 -->
    <select id="doctorSelectById" parameterType="long" resultType="adminAccount">
        SELECT
        a.admin_id       AS adminId,
        a.name           AS name,
        a.phone          AS phone,
        a.email          AS email,
        a.position       AS position,
        a.license_no     AS licenseNo,
        a.dept_id        AS deptId,
        d.dept_name      AS deptName,
        a.status         AS status,
        a.hired_date     AS hiredDate,
        a.created_at     AS createdAt
        FROM admin_account a
        JOIN department d ON a.dept_id = d.dept_id
        WHERE a.admin_id = #{doctorId}
        AND a.position = 'DOCTOR'
    </select>

    <!--  부서별 의사 목록 -->
    <select id="doctorSelectByDepartment" parameterType="long" resultType="adminAccount">
        SELECT
        a.admin_id       AS adminId,
        a.name           AS name,
        a.phone          AS phone,
        a.email          AS email,
        a.position       AS position,
        a.license_no     AS licenseNo,
        a.dept_id        AS deptId,
        d.dept_name      AS deptName,
        a.status         AS status,
        a.hired_date     AS hiredDate
        FROM admin_account a
        JOIN department d ON a.dept_id = d.dept_id
        WHERE a.dept_id = #{deptId}
        AND a.position = 'DOCTOR'
        ORDER BY a.name ASC
    </select>

    <!--  의사 정보 등록 -->
    <insert id="insertDoctor" parameterType="adminAccount" useGeneratedKeys="true" keyProperty="adminId">
        INSERT INTO admin_account (
        emp_id, password, name, phone, email, position, role, license_no, dept_id, status, hired_date, created_at
        ) VALUES (
        #{empId}, #{password}, #{name}, #{phone}, #{email}, 'DOCTOR', 'ADMIN', #{licenseNo}, #{deptId}, #{status}, #{hiredDate}, NOW()
        )
    </insert>

    <!--  의사 정보 수정 -->
    <update id="editDoctor" parameterType="adminAccount">
        UPDATE admin_account
        SET
        name = #{name},
        phone = #{phone},
        email = #{email},
        license_no = #{licenseNo},
        dept_id = #{deptId},
        status = #{status},
        hired_date = #{hiredDate}
        WHERE admin_id = #{adminId}
        AND position = 'DOCTOR'
    </update>

    <!--  의사 삭제 -->
    <delete id="delDoctor" parameterType="long">
        DELETE FROM admin_account
        WHERE admin_id = #{doctorId}
        AND position = 'DOCTOR'
    </delete>

    <!--  진료비 조회 (부서 기준) -->
    <select id="getConsultFeeByDoctorId" parameterType="long" resultType="map">
        SELECT
        d.consult_fee  AS consultFee,
        d.insurance_rate AS insuranceRate
        FROM admin_account a
        JOIN department d ON a.dept_id = d.dept_id
        WHERE a.admin_id = #{doctorId}
        AND a.position = 'DOCTOR'
    </select>

    <!--  의사 소속 부서명 조회 -->
    <select id="findDepartmentByDoctorId" parameterType="long" resultType="string">
        SELECT dept.dept_name
        FROM admin_account a
        JOIN department dept ON a.dept_id = dept.dept_id
        WHERE a.admin_id = #{doctorId}
        AND a.position = 'DOCTOR'
    </select>



</mapper>

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mediSync.project.mapper.PrescriptionMapper">

    <!--  처방전 등록  -->
    <insert id="insertPrescription" parameterType="prescription">
        INSERT INTO prescription (
        record_id, type, drug_name, dosage, duration,
        test_name, test_area, test_date,
        injection_name, injection_count, injection_area, created_at
        )
        VALUES (
        #{recordId}, #{type}, #{drugName}, #{dosage}, #{duration},
        #{testName}, #{testArea}, #{testDate},
        #{injectionName}, #{injectionCount}, #{injectionArea}, NOW()
        )
    </insert>
    <!--  처방 내역 조회  -->
    <select id="selectPrescription" resultType="prescription">
        SELECT * FROM prescription
    </select>
    <!--  처방 내역 검색(환자별)  -->
    <select id="selectPrescriptionByPatientId" parameterType="long" resultType="prescription">
        SELECT * FROM prescription p
        JOIN medical_record mr ON p.record_id = mr.record_id
        WHERE mr.record_id = #{recordId}
        ORDER BY p.created_at DESC
    </select>
</mapper>
